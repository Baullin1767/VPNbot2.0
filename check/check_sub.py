import asyncio

from config import bot, ADMINS
from data_base import db
from datetime import datetime as dt

async def check():
    invited=0
    coust = 200
    trial_text = '''–ü—Ä–∏–≤–µ—Ç!

–ë–µ—Å–ø–ª–∞—Ç–Ω—ã–π –ø–µ—Ä–∏–æ–¥ –ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –∑–∞–∫–æ–Ω—á–∏–ª—Å—è, –∏ –µ—Å–ª–∏ —Ç—ã —Ö–æ—á–µ—à—å –ø—Ä–æ–¥–æ–ª–∂–∞—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è –º–æ–∏–º VPN,\
—Ç–æ, –ø–æ–∂–∞–ª—É–π—Å—Ç–∞, –æ–ø–ª–∞—Ç–∏ —Å–ª–µ–¥—É—é—â–∏–π –º–µ—Å—è—Ü

–î–ª—è —ç—Ç–æ–≥–æ —Ç–µ–±–µ –Ω—É–∂–Ω–æ –ø–µ—Ä–µ–≤–µ—Å—Ç–∏ 200‚ÇΩ –Ω–∞ –∫–∞—Ä—Ç—É *–¢–∏–Ω–∫–æ—Ñ—Ñ* –ø–æ –Ω–æ–º–µ—Ä—É —Ç–µ–ª–µ—Ñ–æ–Ω–∞ 788888888 –ò–≤–∞–Ω –ò. –∏ –æ—Ç–ø—Ä–∞–≤–∏—Ç—å –º–Ω–µ —Å–∫—Ä–∏–Ω –æ–ø–ª–∞—Ç—ã'''
    sub_text = '''–ü—Ä–∏–≤–µ—Ç!

–û–ø–ª–∞—á–µ–Ω–Ω—ã–π –ø–µ—Ä–∏–æ–¥ –ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –∑–∞–∫–æ–Ω—á–∏—Ç—Å—è –∑–∞–≤—Ç—Ä–∞, –∏ –µ—Å–ª–∏ —Ç—ã —Ö–æ—á–µ—à—å –ø—Ä–æ–¥–æ–ª–∂–∞—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è –º–æ–∏–º VPN, —Ç–æ, –ø–æ–∂–∞–ª—É–π—Å—Ç–∞, –æ–ø–ª–∞—Ç–∏ —Å–ª–µ–¥—É—é—â–∏–π –º–µ—Å—è—Ü.

–ò–Ω–∞—á–µ –¥–æ—Å—Ç—É–ø –±—É–¥–µ—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω –∏ —Ç—ã –Ω–µ —Å–º–æ–∂–µ—à—å –ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è –º–æ–∏–º —Å–µ—Ä–≤–∏—Å–æ–º)

–î–ª—è —ç—Ç–æ–≥–æ —Ç–µ–±–µ –Ω—É–∂–Ω–æ –ø–µ—Ä–µ–≤–µ—Å—Ç–∏ 200‚ÇΩ –Ω–∞ –∫–∞—Ä—Ç—É *–¢–∏–Ω–∫–æ—Ñ—Ñ* –ø–æ –Ω–æ–º–µ—Ä—É —Ç–µ–ª–µ—Ñ–æ–Ω–∞ 788888888 –ò–≤–∞–Ω –ò. –∏ –æ—Ç–ø—Ä–∞–≤–∏—Ç—å –º–Ω–µ —Å–∫—Ä–∏–Ω –æ–ø–ª–∞—Ç—ã.'''

    sub_text_sale = lambda invited, coust :f'''–ü—Ä–∏–≤–µ—Ç!

–û–ø–ª–∞—á–µ–Ω–Ω—ã–π –ø–µ—Ä–∏–æ–¥ –ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –∑–∞–∫–æ–Ω—á–∏—Ç—Å—è –∑–∞–≤—Ç—Ä–∞, –∏ –µ—Å–ª–∏ —Ç—ã —Ö–æ—á–µ—à—å –ø—Ä–æ–¥–æ–ª–∂–∞—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è –º–æ–∏–º VPN, —Ç–æ, –ø–æ–∂–∞–ª—É–π—Å—Ç–∞, –æ–ø–ª–∞—Ç–∏ —Å–ª–µ–¥—É—é—â–∏–π –º–µ—Å—è—Ü.

–ò–Ω–∞—á–µ –¥–æ—Å—Ç—É–ø –±—É–¥–µ—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω –∏ —Ç—ã –Ω–µ —Å–º–æ–∂–µ—à—å –ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è –º–æ–∏–º —Å–µ—Ä–≤–∏—Å–æ–º)

–í —ç—Ç–æ–º –º–µ—Å—è—Ü–µ –ø–æ —Ç–≤–æ–µ–π —Ä–µ—Ñ–µ—Ä–∞–ª—å–Ω–æ–π —Å—Å—ã–ª–∫–µ –ø–æ–¥–∫–ª—é—á–∏–ª–æ—Å—å {invited} —á–µ–ª–æ–≤–µ–∫, –∏ –ø–æ—ç—Ç–æ–º—É, —Å —É—á–µ—Ç–æ–º —Å–∫–∏–¥–∫–∏, \
—Ç–µ–±–µ –Ω—É–∂–Ω–æ –ø–µ—Ä–µ–≤–µ—Å—Ç–∏ {coust}‚ÇΩ –Ω–∞ –∫–∞—Ä—Ç—É *–¢–∏–Ω–∫–æ—Ñ—Ñ* –ø–æ –Ω–æ–º–µ—Ä—É
—Ç–µ–ª–µ—Ñ–æ–Ω–∞ 788888888 –ò–≤–∞–Ω –ò. –∏ –æ—Ç–ø—Ä–∞–≤–∏—Ç—å –º–Ω–µ —Å–∫—Ä–∏–Ω –æ–ø–ª–∞—Ç—ã.

–°–ø–∞—Å–∏–±–æ, —á—Ç–æ —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—à—å –Ω–∞—Åüíô'''

    sub_text_free = f'''–ü—Ä–∏–≤–µ—Ç!

–í —ç—Ç–æ–º –º–µ—Å—è—Ü–µ –ø–æ —Ç–≤–æ–µ–π —Ä–µ—Ñ–µ—Ä–∞–ª—å–Ω–æ–π —Å—Å—ã–ª–∫–µ –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–ª–æ—Å—å 5 —á–µ–ª–æ–≤–µ–∫, –ø–æ—ç—Ç–æ–º—É —Ç—ã –ø–æ–ª—É—á–∞–µ—à—å –±–µ—Å–ø–ª–∞—Ç–Ω—ã–π –º–µ—Å—è—Ü –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è VPN.\
–°–ø–∞—Å–∏–±–æ, —á—Ç–æ —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—à—å –Ω–∞—Åüíô

–Ø –Ω–∞–ø–æ–º–Ω—é –∫–æ–≥–¥–∞ –Ω—É–∂–Ω–æ –±—É–¥–µ—Ç –∑–∞–ø–ª–∞—Ç–∏—Ç—å –≤ —Å–ª–µ–¥—É—é—â–∏–π —Ä–∞–∑.

–¢–≤–æ–π Stark's VPN'''


    while True:
        users = db.get_users()
        for user in users:
            user_id = user[0]
            date_sub = user[4]
            trial = user[-4]
            invited = user[-3]
            print(f'{user_id=}, {date_sub=}, {trial=}, {invited=}')
            if date_sub != None:
                date_sub = dt.strptime(date_sub, "%Y-%m-%d").date()
            else:
                continue
            if date_sub <= dt.now().date():
                if trial:
                    text = trial_text
                    db.add_trial(user_id, False)
                    db.add_date_sub(user_id, None)
                else:
                    if invited == 0:
                        text = sub_text
                    elif 1 <= invited < 5:
                        coust = 200 - 40 * invited
                        text = sub_text_sale(invited, coust)
                    elif invited == 5:
                        text = sub_text_free
                    db.add_date_sub(user_id, None)
                    db.drop_invited(user_id)
                await bot.send_message(user_id, text, parse_mode='Markdown')
                await bot.send_message(ADMINS[0], f'{text}\n\n' +
                            f'#ID{user_id} ', parse_mode='Markdown')
        await asyncio.sleep(10*60)